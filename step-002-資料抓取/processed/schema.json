{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "高中國文學測資料 DSL/DDD Schema",
  "description": "多維融合型格式，包含題目、知識、推理、回答四個維度",
  "type": "object",
  "required": ["id", "meta", "question_layer", "knowledge_layer", "reasoning_layer", "answer_layer"],
  "properties": {
    "id": {
      "type": "string",
      "description": "唯一識別碼，格式：{類型}-{年度}-{編號}"
    },
    "meta": {
      "type": "object",
      "required": ["source_url", "source_type", "created_at"],
      "properties": {
        "source_url": { "type": "string", "format": "uri" },
        "source_type": {
          "type": "string",
          "enum": ["official_exam", "mock_exam", "curriculum", "knowledge", "writing"]
        },
        "year": { "type": "integer" },
        "subject": { "type": "string", "default": "國文" },
        "exam_type": { "type": "string" },
        "created_at": { "type": "string", "format": "date-time" },
        "raw_file_path": { "type": "string" }
      }
    },
    "question_layer": {
      "type": "object",
      "properties": {
        "original_text": { "type": "string" },
        "question_type": {
          "type": "string",
          "enum": ["閱讀理解", "字音辨析", "字形辨析", "成語運用", "修辭判斷", "文意判讀", "國學常識", "作文"]
        },
        "subtypes": { "type": "array", "items": { "type": "string" } },
        "options": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "text": { "type": "string" },
              "is_correct": { "type": "boolean" },
              "trap_type": {
                "type": ["string", "null"],
                "enum": [null, "斷章取義", "過度推論", "張冠李戴", "以偏概全", "望文生義", "混淆時序"]
              }
            }
          }
        },
        "difficulty": {
          "type": "object",
          "properties": {
            "level": { "type": "integer", "minimum": 1, "maximum": 5 },
            "discrimination": { "type": "number", "minimum": 0, "maximum": 1 }
          }
        }
      }
    },
    "knowledge_layer": {
      "type": "object",
      "properties": {
        "domains": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "subtopics": { "type": "array", "items": { "type": "string" } },
              "curriculum_reference": { "type": "string" }
            }
          }
        },
        "prerequisites": { "type": "array", "items": { "type": "string" } },
        "related_classics": { "type": "array", "items": { "type": "string" } },
        "vocabulary": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "term": { "type": "string" },
              "definition": { "type": "string" },
              "example": { "type": "string" }
            }
          }
        }
      }
    },
    "reasoning_layer": {
      "type": "object",
      "properties": {
        "cognitive_level": {
          "type": "string",
          "enum": ["記憶", "理解", "應用", "分析", "評鑑", "創造"]
        },
        "thinking_process": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "step": { "type": "integer" },
              "action": { "type": "string" },
              "note": { "type": "string" }
            }
          }
        },
        "key_insight": { "type": "string" },
        "common_errors": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "error_type": { "type": "string" },
              "description": { "type": "string" }
            }
          }
        }
      }
    },
    "answer_layer": {
      "type": "object",
      "properties": {
        "correct_answer": { "type": "string" },
        "answer_rationale": { "type": "string" },
        "scoring_criteria": {
          "type": "object",
          "properties": {
            "full_credit": { "type": "string" },
            "partial_credit": { "type": ["string", "null"] },
            "zero_credit": { "type": "string" }
          }
        },
        "model_response": {
          "type": "object",
          "properties": {
            "ideal_response": { "type": "string" },
            "response_structure": { "type": "array", "items": { "type": "string" } }
          }
        }
      }
    }
  }
}
