# 地雷經驗：WebFetch 工具抓取網頁時的常見問題

## 問題時間
2025-12-13

## 遇到的地雷

在使用 WebFetch 工具抓取多個 108 課綱相關網站時，遇到兩種主要失敗情況：

### 1. SSL 憑證驗證失敗
**錯誤訊息**: "unable to verify the first certificate"
**失敗網址**: https://ph2.com.tw/blog/108-curriculum-chinese-cheat-sheet/

**原因分析**:
- 目標網站的 SSL 憑證配置有問題（可能是中繼憑證缺失）
- WebFetch 工具預設會嚴格驗證 SSL 憑證
- 某些教育機構或個人網站的 SSL 配置不完整

### 2. 資料大小計算錯誤
**錯誤訊息**: "sizeCalculation return invalid (expect positive integer)"
**失敗網址**: https://tw.amazingtalker.com/blog/zh-tw/k12/74304/

**原因分析**:
- 網頁內容過大或結構複雜，導致大小計算異常
- 可能包含大量圖片、動態內容或特殊格式
- WebFetch 工具內部的大小計算邏輯遇到邊界情況

### 3. 圖片內容未能提取
**情況**: 網頁中有圖片包含重要資訊（如 15 篇古文篇目清單），但無法從 HTML 中提取

**原因分析**:
- 重要內容以圖片形式呈現，而非文字
- WebFetch 轉換為 Markdown 後遺失圖片中的文字資訊
- 需要 OCR 或直接查看圖片才能獲取完整資料

## 解決方案

### 針對 SSL 憑證問題
1. **替代來源**: 尋找相同資訊的其他可靠來源
2. **手動下載**: 使用瀏覽器直接訪問並複製內容
3. **官方文件**: 優先使用政府或教育部官方網站（通常 SSL 配置較完整）

### 針對大小計算問題
1. **簡化 URL**: 如果是文章頁面，確認 URL 是否指向單一文章而非列表頁
2. **替代工具**: 考慮使用 `curl` 或 `wget` 透過 Bash 工具下載，再用 Read 工具讀取
3. **分段抓取**: 如果網站有分頁，嘗試分段抓取較小的部分

### 針對圖片內容問題
1. **查閱官方文件**: 教育部或課審會通常會有文字版的正式文件
2. **交叉驗證**: 使用多個來源交叉確認資訊（本次從樵客老師部落格成功獲取完整篇目）
3. **手動補充**: 必要時請使用者提供或手動查閱官方課綱文件

## 實際應對策略

本次任務中的應對方式：
1. **平行抓取**: 同時抓取 8 個網址，成功 5 個，失敗 3 個
2. **標記狀態**: 在 JSONL 輸出中明確標記每筆資料的狀態（success/failed/partial）
3. **互補資料**: 從成功的來源（如樵客老師部落格、中央社）獲得完整的古文篇目清單
4. **保留錯誤資訊**: 記錄失敗原因，方便後續手動處理或尋找替代方案

## 成功案例

成功抓取的網站特徵：
- PaGamO: 教育平台，結構清晰，SSL 正常
- 國語文學科中心: 官方教育網站，資料完整
- 樵客老師部落格: 個人部落格但內容詳實，提供完整 25 篇古文清單
- 中央社、關鍵評論網: 新聞媒體，技術規範完善

## 預防建議

1. **優先順序**: 官方網站 > 知名媒體 > 教育平台 > 個人部落格
2. **事前檢查**: 先用瀏覽器確認網站可正常訪問且 SSL 有效
3. **備援方案**: 準備多個資料來源，避免單點失敗
4. **資料驗證**: 從多個來源交叉驗證重要資訊（如古文篇目清單）

## 參考時機

當需要使用 WebFetch 工具大量抓取網頁資料時，特別是：
- 教育課綱相關網站
- 個人部落格或小型網站
- 內容包含大量圖片的網頁
- 遇到 SSL 或大小計算錯誤時

## 經驗總結

WebFetch 工具適合抓取結構良好的現代網站，但對於：
- SSL 配置不完整的網站
- 內容過於複雜或龐大的網頁
- 以圖片呈現重要資訊的頁面

需要有備援策略。最佳做法是平行抓取多個來源，並交叉驗證資料完整性。
